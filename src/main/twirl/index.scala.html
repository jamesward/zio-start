@(archetypesWithLabels: Map[String, Map[String, Set[(String, String)]]])

<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>ZIO Start</title>

        @* todo: webjars *@
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <style>
            body {
                margin: 20px;
            }
        </style>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                for (let b of document.getElementsByClassName('download')) {
                    b.addEventListener('click', event => {
                        event.preventDefault();
                        event.stopPropagation();

                        // figure out the selected options
                        const archetype = event.currentTarget.dataset.archetype;

                        const optionInputs = document.getElementsByClassName(archetype + "-option");

                        const selected = Array.from(optionInputs)
                                .filter( e => e.checked )
                                .map( optionInput => {
                                    const optionGroupKey = optionInput.name;
                                    const optionValue = optionInput.value;
                                    return `${optionGroupKey}-${optionValue}`;
                                });

                        const options = selected.join('+');

                        const a = document.createElement('a');
                        a.href = `/zip/${archetype}/${options}`;
                        a.download = `${archetype}.zip`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    });
                }
            });

        </script>
    </head>
    <body>
        Select Archetype:
        <div class="accordion" id="archetypes">
            @for((archetype, optionGroups) <- archetypesWithLabels) {
                <div id="@archetype" class="archetype accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                            @archetype
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#archetypes">
                        <div class="accordion-body">
                            <form>
                                @for((optionGroupKey, options) <- optionGroups) {
                                    <div id="@optionGroupKey" class="optionGroup">
                                        @optionGroupKey:
                                        @for((optionKey, optionLabel) <- options) {
                                            <div class="form-check">
                                                <input class="form-check-input @archetype-option" type="radio" name="@optionGroupKey" value="@optionKey" id="@optionGroupKey-@optionKey">
                                                <label class="form-check-label" for="@optionGroupKey-@optionKey">@optionLabel</label>
                                            </div>
                                        }
                                    </div>
                                }

                                <button class="download" data-archetype="@archetype">Download ZIP</button>
                                <button disabled>Create GitHub Repo</button>
                                <button disabled>Cloud Deploy</button>
                            </form>
                        </div>
                    </div>
                </div>
        }
    </body>
</html>